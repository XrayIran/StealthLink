# UQSP Agent Configuration Example
# This configuration sets up a UQSP (Unified QUIC Superset Protocol) agent

role: agent

agent:
  id: "agent1"
  gateway_addr: "gateway.example.com:8443"
  reconnect_backoff: "3s"

# UQSP Transport Configuration
transport:
  type: uqsp
  uqsp:
    handshake:
      auth_mode: token        # token, cert, or psk
      enable_0rtt: true       # Enable 0-RTT for faster reconnections
      anti_replay_window: 64

    streams:
      max_concurrent: 100
      flow_control_window: 1048576  # 1MB
      max_incoming_streams: 1024
      max_incoming_uni_streams: 128

    datagrams:
      max_size: 1350
      enable_fragmentation: true
      relay_mode: native      # native or capsule
      max_incoming_datagrams: 1024

    capsules:
      connect_udp: true
      connect_ip: false
      context_policy: optional  # required, optional, or disabled
      max_context_id: 16777215

    congestion:
      algorithm: bbr          # bbr, brutal, or cubic
      pacing: adaptive        # adaptive, aggressive, or conservative
      adaptive_mode: true
      bandwidth_mbps: 100     # for brutal algorithm

    obfuscation:
      profile: adaptive       # adaptive, salamander, or none
      salamander_key: ""      # required if profile=salamander
      padding_min: 16
      padding_max: 128
      timing_jitter_ms: 0
      morphing_enabled: false
      # Obfuscation chain (optional, for multiple layers)
      chain:
        - type: salamander
          key: ""
        - type: padding
          params:
            min: "16"
            max: "128"
            strategy: "random"

    awg_profile:
      enabled: false          # Enable AWG-style junk/padding
      junk_interval: 5s       # Interval for junk packet injection

    # Protocol behavior overlays
    behaviors:
      shadowtls:
        enabled: false
        version: 3
        handshake_dest: "www.microsoft.com"
        password: ""
      tlsmirror:
        enabled: false
        enrollment_required: false
      reality:
        enabled: false
        dest: "www.microsoft.com"
        private_key: ""
        server_public_key: ""  # Optional override for REALITY server signing key
      awg:
        enabled: false
        junk_interval: 5s
        junk_min_size: 64
        junk_max_size: 1024
      ech:
        enabled: false
        public_name: "cloudflare-ech.com"
        inner_sni: ""
        require_ech: false

    security:
      tls_min_version: "1.3"
      pq_kem: false           # post-quantum key exchange
      key_rotation: 24h

# Legacy stealth config (kept for TLS CA reference, will be deprecated)
  stealth:
    camouflage:
      tls:
        ca_file: "/path/to/ca.pem"
        server_name: "example.com"
        insecure_skip_verify: false

# SMux Configuration
mux:
  max_streams_per_session: 100
  max_streams_total: 1000
  header_timeout: "10s"
  smux_keepalive_interval: "2s"
  smux_keepalive_timeout: "8s"
  max_stream_buffer: 1048576
  max_receive_buffer: 4194304

# Security Configuration
security:
  shared_key: "your-shared-secret-key"
  # Or use multiple keys for rotation:
  # shared_keys:
  #   - "new-key"
  #   - "old-key"

  replay_protect: true
  replay_capacity: 1000000

# Service Definitions
services:
  - name: "ssh"
    protocol: tcp
    target: "127.0.0.1:22"
    max_streams: 100

  - name: "socks5"
    protocol: tcp
    listen: "127.0.0.1:1080"
    max_streams: 200

# SOCKS5 Proxy Configuration (optional)
# transparent_proxy:
#   enabled: true
#   listen: "127.0.0.1:1080"

# Metrics Configuration
metrics:
  listen: "127.0.0.1:9091"
  auth_token: ""

# VPN Configuration (TUN mode for full L3 VPN tunneling)
vpn:
  enabled: false          # Enable VPN mode for full TUN tunneling (L3-only)
  mode: tun               # "tun" (layer 3, IP)
  name: "stealth0"        # Interface name
  interface_ip: "10.0.0.2/24"  # Local VPN IP with CIDR
  peer_ip: "10.0.0.1"     # Remote peer VPN IP (point-to-point)
  mtu: 1400               # Interface MTU (default: 1400)
  routes:                 # Additional routes to add
    - destination: "0.0.0.0/0"  # Default route through VPN
      metric: 100
  dns:                    # DNS servers to use
    - "1.1.1.1"
    - "8.8.8.8"
  reverse:
    enabled: false        # Enable reverse proxy integration

# XHTTP + Domain Fronting + ECH + Vision configuration (Method HTTP+)
# Uncomment to enable the hardest-to-detect mode
# transport:
#   uqsp:
#     carrier:
#       type: xhttp
#       xhttp:
#         server: "cdn.example.com:443"
#         mode: stream-one
#         tls_fingerprint: "chrome"
#     behaviors:
#       ech:
#         enabled: true
#         public_name: "cloudflare-ech.com"
#         inner_sni: "real.example.com"
#         require_ech: true
#       domainfront:
#         enabled: true
#         front_domain: "cdn.cloudflare.com"
#         real_host: "real.example.com"
#       vision:
#         enabled: true
#       tlsfrag:
#         enabled: true
#         strategy: sni_split

# Raw TCP + obfs4 configuration (Method TCP+)
# transport:
#   uqsp:
#     carrier:
#       type: rawtcp
#       rawtcp:
#         raw:
#           interface: eth0
#           ipv4:
#             addr: "0.0.0.0:8443"
#             router_mac: "aa:bb:cc:dd:ee:ff"
#     behaviors:
#       obfs4:
#         enabled: true
#         node_id: "base64-encoded-node-id"
#         public_key: "base64-encoded-public-key"

# TLS-based tunnel configuration (Method TLS - WebTunnel)
# transport:
#   uqsp:
#     carrier:
#       type: webtunnel
#       webtunnel:
#         server: "tunnel.example.com:443"
#         path: "/tunnel"
#         version: h2
#         tls_fingerprint: "chrome"

# TLS-based tunnel configuration (Method TLS - Chisel SSH-over-HTTP)
# transport:
#   uqsp:
#     carrier:
#       type: chisel
#       chisel:
#         server: "proxy.example.com:443"
#         path: "/"
#         auth: "user:pass"
#         tls_fingerprint: "chrome"

# XHTTP + REALITY + Vision (Method TLS+)
# transport:
#   uqsp:
#     carrier:
#       type: xhttp
#       xhttp:
#         server: "cdn.example.com:443"
#         mode: stream-one
#         tls_fingerprint: "chrome"
#     behaviors:
#       reality:
#         enabled: true
#         dest: "www.microsoft.com:443"
#         private_key: "base64-x25519-private-key"
#       vision:
#         enabled: true
#         flow_auto_detect: true
#     security:
#       pq_kem: true  # ML-DSA-65 post-quantum signatures

# UDP with Brutal CC + Salamander + AWG (Method UDP+)
# transport:
#   uqsp:
#     congestion:
#       algorithm: brutal
#       bandwidth_mbps: 200
#     obfuscation:
#       profile: salamander
#       salamander_key: "your-secret-key"
#       morphing_enabled: true
#     behaviors:
#       awg:
#         enabled: true
#         junk_interval: 5s

# Logging Configuration
logging:
  level: info  # debug, info, warn, error
